enum Gender {
  MALE
  FEMALE
  OTHER
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
  DOMESTIC_PARTNERSHIP
}

enum DependentRelationship {
  SPOUSE
  CHILD
  PARENT
  SIBLING
  OTHER
}

enum InsurerType {
  MEDICINA_PREPAGADA
  COMPANIA_DE_SEGUROS
}

// ── Client ──────────────────────────────────────────────────────────

model Client {
  id       String  @id @default(uuid()) @db.Uuid
  orgId    String  @map("org_id") @db.Uuid
  name     String  @db.VarChar(255)
  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  affiliates   Affiliate[]
  policies     Policy[]
  claims       Claim[]
  userClients  UserClient[]

  @@index([orgId])
  @@index([isActive])
  @@map("clients")
}

// ── Insurer ──────────────────────────────────────────────────────────

model Insurer {
  id    String @id @default(uuid()) @db.Uuid
  orgId String @map("org_id") @db.Uuid

  name    String  @db.VarChar(255)
  code    String? @db.VarChar(50)
  email   String? @db.VarChar(255)
  phone   String? @db.VarChar(50)
  website String? @db.VarChar(500)

  type     InsurerType
  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  organization Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  policies     Policy[]

  @@unique([orgId, name])
  @@unique([orgId, code])
  @@index([orgId])
  @@index([isActive])
  @@map("insurers")
}

// ── Affiliate ───────────────────────────────────────────────────────

model Affiliate {
  id    String @id @default(uuid()) @db.Uuid
  orgId String @map("org_id") @db.Uuid

  // Identity
  firstName      String  @map("first_name") @db.VarChar(100)
  lastName       String  @map("last_name") @db.VarChar(100)
  documentType   String? @map("document_type") @db.VarChar(50)
  documentNumber String? @map("document_number") @db.VarChar(100)

  // Contact
  email String? @db.VarChar(255)
  phone String? @db.VarChar(50)

  // Demographics
  dateOfBirth   DateTime?      @map("date_of_birth") @db.Date
  gender        Gender?
  maritalStatus MaritalStatus? @map("marital_status")

  // Dependent relationship
  primaryAffiliateId String?    @map("primary_affiliate_id") @db.Uuid
  primaryAffiliate   Affiliate?  @relation("AffiliateDependents", fields: [primaryAffiliateId], references: [id], onDelete: SetNull)
  dependents         Affiliate[] @relation("AffiliateDependents")
  relationship       DependentRelationship?

  // Ownership
  clientId String @map("client_id") @db.Uuid
  client   Client @relation(fields: [clientId], references: [id])

  // Optional portal access
  userId String? @unique @map("user_id") @db.Uuid
  user   User?   @relation(fields: [userId], references: [id])

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz

  organization    Organization @relation(fields: [orgId], references: [id], onDelete: Cascade)
  claimsAsHolder  Claim[]      @relation("ClaimAffiliate")
  claimsAsPatient Claim[]      @relation("ClaimPatient")
  enrollments         PolicyEnrollment[]
  enrolledAsDependent EnrollmentDependent[] @relation("EnrolledAsDependent")

  @@index([orgId])
  @@index([clientId])
  @@index([userId])
  @@index([primaryAffiliateId])
  @@index([documentNumber])
  @@index([lastName, firstName])
  @@index([isActive])
  @@map("affiliates")
}
